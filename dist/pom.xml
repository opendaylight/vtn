<?xml version="1.0" encoding="UTF-8"?>

<!--
#
# Copyright (c) 2013 NEC Corporation
# All rights reserved.
# 
# This program and the accompanying materials are made available under the
# terms of the Eclipse Public License v1.0 which accompanies this
# distribution, and is available at http://www.eclipse.org/legal/epl-v10.html
#
-->

<project xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd" xmlns="http://maven.apache.org/POM/4.0.0"
	 xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <modelVersion>4.0.0</modelVersion>
  <prerequisites>
    <maven>3.0</maven>
  </prerequisites>

  <scm>
    <connection>scm:git:https://git.opendaylight.org/gerrit/p/vtn.git</connection>
    <developerConnection>scm:git:ssh://git.opendaylight.org:29418/vtn.git</developerConnection>
  </scm>

  <groupId>org.opendaylight.vtn</groupId>
  <artifactId>distribution.vtn-coordinator</artifactId>
  <version>5.0.0.0-SNAPSHOT</version>
  <packaging>pom</packaging>

  <profiles>
    <profile>
      <id>viewbuild</id>
      <activation>
        <activeByDefault>true</activeByDefault>
      </activation>
      <properties>
        <build.suffix>${project.version}</build.suffix>
        <vtn.build.id></vtn.build.id>
      </properties>
    </profile>
    <profile>
      <id>jenkins</id>
      <activation>
        <property>
          <name>BUILDSUFFIX</name>
        </property>
      </activation>
      <properties>
        <build.suffix>${BUILDSUFFIX}</build.suffix>
        <vtn.build.id>${BUILDSUFFIX}</vtn.build.id>
      </properties>
    </profile>
  </profiles>

  <properties>
    <nexusproxy>http://nexus.opendaylight.org/content</nexusproxy>
    <propertymavenplugin.version>1.0-alpha-2</propertymavenplugin.version>
    <sitedeploy>dav:http://nexus.opendaylight.org/content/sites/site</sitedeploy>

    <!-- Run tests by default. -->
    <skipTests>false</skipTests>
    <maven.test.skip>false</maven.test.skip>

    <vtn.java.libdir>${basedir}/target/java</vtn.java.libdir>
    <vtn.tomcat.libdir>${basedir}/target/tomcat</vtn.tomcat.libdir>
    <vtn.gson.version>2.2.2</vtn.gson.version>
    <vtn.json.version>20090211</vtn.json.version>
    <vtn.tomcat.version>7.0.39</vtn.tomcat.version>
    <vtn.junit.version>4.8.1</vtn.junit.version>

    <vtn.build.destdir>root</vtn.build.destdir>
    <vtn.build.prefix>/usr/local/vtn</vtn.build.prefix>
    <vtn.build.debug>true</vtn.build.debug>

    <!-- The number of GNU make jobs -->
    <vtn.build.jobs>1</vtn.build.jobs>

    <vtn.pkg.classifier>bin</vtn.pkg.classifier>
    <vtn.pkg.type>tar.bz2</vtn.pkg.type>
    <vtn.pkg.name>${project.artifactId}-${build.suffix}</vtn.pkg.name>
    <vtn.pkg.filename>
      ${vtn.pkg.name}-${vtn.pkg.classifier}.${vtn.pkg.type}
    </vtn.pkg.filename>
    <vtn.pkg.path>${basedir}/target/${vtn.pkg.filename}</vtn.pkg.path>
  </properties>

  <repositories>
    <repository>
      <id>svnkit-snapshots</id>
      <name>svnkit-snapshots</name>
      <url>${nexusproxy}/repositories/svnkit-snapshots/</url>
    </repository>
  </repositories>

  <distributionManagement>
    <!-- OpenDayLight Released artifact -->
    <repository>
      <id>opendaylight-release</id>
      <url>${nexusproxy}/repositories/opendaylight.release/</url>
    </repository>
    <!-- OpenDayLight Snapshot artifact -->
    <snapshotRepository>
      <id>opendaylight-snapshot</id>
      <url>${nexusproxy}/repositories/opendaylight.snapshot/</url>
    </snapshotRepository>
    <!-- Site deployment -->
    <site>
      <id>website</id>
      <url>${sitedeploy}</url>
    </site>
  </distributionManagement>

  <build>
    <defaultGoal>package</defaultGoal>
    <finalName>${vtn.pkg.name}</finalName>
    <plugins>
      <!-- Derive build number from SCM. -->
      <plugin>
        <groupId>org.codehaus.mojo</groupId>
        <artifactId>buildnumber-maven-plugin</artifactId>
        <version>1.2</version>
        <executions>
          <execution>
            <phase>validate</phase>
            <goals>
              <goal>create</goal>
            </goals>
          </execution>
        </executions>
        <configuration>
          <doCheck>false</doCheck>
          <doUpdate>false</doUpdate>
          <providerImplementations>
            <svn>javasvn</svn>
          </providerImplementations>
          <revisionOnScmFailure>unknown</revisionOnScmFailure>
        </configuration>
        <dependencies>
          <dependency>
            <groupId>com.google.code.maven-scm-provider-svnjava</groupId>
            <artifactId>maven-scm-provider-svnjava</artifactId>
            <version>2.0.5</version>
          </dependency>
          <dependency>
            <groupId>org.tmatesoft.svnkit</groupId>
            <artifactId>svnkit</artifactId>
            <version>1.7.4-v1</version>
          </dependency>
          <dependency>
            <groupId>org.apache.maven.scm</groupId>
            <artifactId>maven-scm-provider-svn-commons</artifactId>
            <version>1.7</version>
          </dependency>
        </dependencies>
      </plugin>

      <plugin>
        <artifactId>maven-dependency-plugin</artifactId>
        <version>2.1</version>
        <executions>
          <execution>
            <id>setup-java-libs</id>
            <phase>initialize</phase>
            <goals>
              <goal>copy</goal>
            </goals>
            <configuration>
	      <!-- Copy java libraries -->
	      <artifactItems>
		<artifactItem>
		  <groupId>com.google.code.gson</groupId>
		  <artifactId>gson</artifactId>
		  <version>${vtn.gson.version}</version>
		  <outputDirectory>${vtn.java.libdir}</outputDirectory>
		</artifactItem>
		<artifactItem>
		  <groupId>org.json</groupId>
		  <artifactId>json</artifactId>
		  <version>${vtn.json.version}</version>
		  <outputDirectory>${vtn.java.libdir}</outputDirectory>
		</artifactItem>
		<artifactItem>
		  <groupId>junit</groupId>
		  <artifactId>junit</artifactId>
		  <version>4.8.1</version>
		  <outputDirectory>${vtn.java.libdir}</outputDirectory>
		</artifactItem>

		<artifactItem>
		  <groupId>org.apache.tomcat</groupId>
		  <artifactId>tomcat-catalina</artifactId>
		  <version>${vtn.tomcat.version}</version>
		  <outputDirectory>${vtn.tomcat.libdir}</outputDirectory>
		</artifactItem>
		<artifactItem>
		  <groupId>org.apache.tomcat</groupId>
		  <artifactId>tomcat-servlet-api</artifactId>
		  <version>${vtn.tomcat.version}</version>
		  <outputDirectory>${vtn.tomcat.libdir}</outputDirectory>
		</artifactItem>
		<artifactItem>
		  <groupId>org.apache.tomcat</groupId>
		  <artifactId>tomcat-jsp-api</artifactId>
		  <version>${vtn.tomcat.version}</version>
		  <outputDirectory>${vtn.tomcat.libdir}</outputDirectory>
		</artifactItem>
		<artifactItem>
		  <groupId>org.apache.tomcat</groupId>
		  <artifactId>tomcat-juli</artifactId>
		  <version>${vtn.tomcat.version}</version>
		  <outputDirectory>${vtn.tomcat.libdir}</outputDirectory>
		</artifactItem>
	      </artifactItems>
            </configuration>
          </execution>
        </executions>
      </plugin>

      <plugin>
	<groupId>org.codehaus.mojo</groupId>
	<artifactId>exec-maven-plugin</artifactId>
	<version>1.1.1</version>
	<executions>
	  <execution>
	    <!-- Initialize build environment. -->
	    <id>vtn-setup</id>
	    <phase>initialize</phase>
	    <goals>
	      <goal>exec</goal>
	    </goals>
	    <configuration>
	      <executable>build/setup</executable>
	      <arguments>
		<argument>-d</argument>
		<argument>${basedir}/target</argument>
		<argument>VTN_VERSION=${project.version}</argument>
		<argument>VTN_SCM_REVISION=${buildNumber}</argument>
		<argument>VTN_BUILD_ID=${vtn.build.id}</argument>
		<argument>VTN_DESTDIR=${vtn.build.destdir}</argument>
		<argument>VTN_PREFIX=${vtn.build.prefix}</argument>
		<argument>VTN_DEBUG=${vtn.build.debug}</argument>
	      </arguments>
	    </configuration>
	  </execution>

	  <!-- Run configure script. -->
	  <execution>
	    <id>vtn-configure</id>
	    <phase>generate-sources</phase>
	    <goals>
	      <goal>exec</goal>
	    </goals>
	    <configuration>
	      <executable>make</executable>
	      <arguments>
		<argument>-C</argument>
		<argument>build</argument>
		<argument>configure</argument>
	      </arguments>
	    </configuration>
	  </execution>

	  <!-- Compile sources. -->
	  <execution>
	    <id>vtn-build</id>
	    <phase>compile</phase>
	    <goals>
	      <goal>exec</goal>
	    </goals>
	    <configuration>
	      <executable>make</executable>
	      <arguments>
		<argument>-C</argument>
		<argument>build</argument>
		<argument>-j${vtn.build.jobs}</argument>
		<argument>install</argument>
	      </arguments>
	    </configuration>
	  </execution>

	  <!-- Compile test programs. -->
	  <execution>
	    <id>vtn-test-compile</id>
	    <phase>test-compile</phase>
	    <goals>
	      <goal>exec</goal>
	    </goals>
	    <configuration>
	      <executable>make</executable>
	      <arguments>
		<argument>-C</argument>
		<argument>build</argument>
		<argument>-j${vtn.build.jobs}</argument>
		<argument>test-all</argument>
		<argument>VTN_SKIP_TEST_BUILD=${maven.test.skip}</argument>
	      </arguments>
	    </configuration>
	  </execution>

	  <!-- Run unit tests. -->
	  <execution>
	    <id>vtn-test-run</id>
	    <phase>test</phase>
	    <goals>
	      <goal>exec</goal>
	    </goals>
	    <configuration>
	      <executable>make</executable>
	      <arguments>
		<argument>-C</argument>
		<argument>build</argument>
		<argument>-j${vtn.build.jobs}</argument>
		<argument>test-test</argument>
		<argument>VTN_SKIP_TEST_BUILD=${maven.test.skip}</argument>
		<argument>VTN_SKIP_TEST=${skipTests}</argument>
	      </arguments>
	    </configuration>
	  </execution>

	  <!-- Create binary distribution package. -->
	  <execution>
	    <id>vtn-package</id>
	    <phase>package</phase>
	    <goals>
	      <goal>exec</goal>
	    </goals>
	    <configuration>
	      <executable>build/pkgmk</executable>
	      <arguments>
	  	<argument>-o</argument>
	  	<argument>${vtn.pkg.path}</argument>
	  	<argument>-p</argument>
	  	<argument>${vtn.build.prefix}</argument>
	  	<argument>${basedir}/target/${vtn.build.destdir}</argument>
	      </arguments>
	    </configuration>
	  </execution>

	  <!-- Clean up build environment. -->
	  <execution>
	    <id>vtn-clean</id>
	    <phase>pre-clean</phase>
	    <goals>
	      <goal>exec</goal>
	    </goals>
	    <configuration>
	      <executable>make</executable>
	      <arguments>
		<argument>-C</argument>
		<argument>build</argument>
		<argument>distclean</argument>
	      </arguments>
	    </configuration>
	  </execution>
	</executions>
      </plugin>

      <!--
	  Add binary distribution package to artifacts.
	  This must be defined after exec-maven-plugin to force execution
	  order.
      -->
      <plugin>
	<groupId>org.codehaus.mojo</groupId>
        <artifactId>build-helper-maven-plugin</artifactId>
        <version>1.8</version>
	<executions>
          <execution>
            <id>vtn-attach-artifacts</id>
            <phase>package</phase>
            <goals>
              <goal>attach-artifact</goal>
            </goals>
            <configuration>
              <artifacts>
                <artifact>
                  <file>${vtn.pkg.path}</file>
                  <type>${vtn.pkg.type}</type>
		  <classifier>${vtn.pkg.classifier}</classifier>
                </artifact>
              </artifacts>
            </configuration>
          </execution>
        </executions>	
      </plugin>
    </plugins>
  </build>

  <dependencies>
    <dependency>
      <groupId>com.google.code.gson</groupId>
      <artifactId>gson</artifactId>
      <version>${vtn.gson.version}</version>
    </dependency>
    <dependency>
      <groupId>org.json</groupId>
      <artifactId>json</artifactId>
      <version>${vtn.json.version}</version>
    </dependency>
    <dependency>
      <groupId>org.apache.tomcat</groupId>
      <artifactId>tomcat-catalina</artifactId>
      <version>${vtn.tomcat.version}</version>
    </dependency>
    <dependency>
      <groupId>org.apache.tomcat</groupId>
      <artifactId>tomcat-servlet-api</artifactId>
      <version>${vtn.tomcat.version}</version>
    </dependency>
    <dependency>
      <groupId>org.apache.tomcat</groupId>
      <artifactId>tomcat-jsp-api</artifactId>
      <version>${vtn.tomcat.version}</version>
    </dependency>
    <dependency>
      <groupId>org.apache.tomcat</groupId>
      <artifactId>tomcat-juli</artifactId>
      <version>${vtn.tomcat.version}</version>
    </dependency>
    <dependency>
      <groupId>junit</groupId>
      <artifactId>junit</artifactId>
      <version>4.8.1</version>
      <scope>test</scope>
    </dependency>
  </dependencies>

</project>
